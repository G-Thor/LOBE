{% extends "__base.jinja" %}
{% block body %}
    <div class='row'>
        <div class='col-12'>
            <h1 class='font-weight-bold'>{{collection.name}}</h1>
            {% if collection.has_assigned_user() %}
                <h3 class='font-weight-bold'>Rödd: {{collection.get_assigned_user()}}</h3>
            {% endif %}
        </div>
        <div class='col-md-6 col-12'>
            <div class='row'>
                <div class='col-7'>
                    <p>Stofnuð þann:</p>
                </div>
                <div class='col-5 text-right'>
                    <p>{{collection.created_at | datetime(format='low')}}</p>
                </div>
                <div class='col-7'>
                    <p>Búið að taka upp:</p>
                </div>
                <div class='col-5 text-right'>
                    <p>{{collection.num_tokens - collection.num_nonrecorded_tokens}} af {{collection.num_tokens}}</p>
                </div>
                <div class='col-7'>
                    <p>Klukkutímar kláraðir:</p>
                </div>
                <div class='col-5 text-right'>
                    <p>{{collection.estimate_hours()}} klst</p>
                </div>
            </div>
        </div>
        <div class='col-md-6 col-12'>
            <div class='row'>
                <div class='col-8'>
                    <p>Söfnun raðað eftir:</p>
                </div>
                <div class='col-4 text-right'>
                    <code>
                        {% if collection.sort_by %}
                            {{collection.sort_by}}
                        {% else %}
                            Sjálfgefin röðun
                        {% endif %}
                    </code>
                </div>
            </div>
            <div class='row'>
                <div class='col-4'>
                    <p>Tegund:</p>
                </div>
                <div class='col-8 text-right'>
                    <code>{%if collection.has_video %}{{macros.btn_icon('video', 'r')}} Myndbandssöfnun
                    {% else %}{{macros.btn_icon('microphone', 'r')}} Hljóðsöfnun{% endif %}
                    </code>
                </div>
            </div>
        </div>
        <div class='col-12'>
            <div class="progress mb-3">
                <div class="progress-bar bg-success" role="progressbar" style="width:{{collection.get_complete_ratio(as_percent=True)}}%"></div>
                <div class="progress-bar bg-warning" role="progressbar" style="width:{{collection.get_invalid_ratio(as_percent=True)}}%"></div>
            </div>
            <button type='button' class='btn btn-success btn-sm float-right mb-2 ml-2' data-toggle='modal', data-target='#confirmModal'>
                {{macros.btn_icon('microphone', 'r')}}
                Taka upp
            </button>
            <a href='{{url_for("collection_sessions", id=collection.id)}}' class='btn btn-sm btn-secondary float-right mb-2 ml-2'>
                {{macros.btn_icon('arrow-right', 'r')}}
                Lotur
            </a>
            {% if current_user.is_admin() %}
                <a href='{{url_for("record_session_beta", coll_id=collection.id)}}' class='btn btn-sm btn-success float-right mb-2 ml-2'>
                    {{macros.btn_icon('microphone', 'r')}}
                    WebRTC (beta)
                </a>
                <button type='button' class='btn btn-secondary btn-sm float-right mb-2 ml-2' data-toggle='modal', data-target='#addTokensModal'>
                    {{macros.btn_icon('plus', 'r')}}
                    Bæta við
                </button>
                <button class="btn btn-secondary float-right ml-2 mb-2 btn-sm" type="button" data-toggle='modal', data-target='#downloadModal'>
                    {{macros.btn_icon('download', 'r')}}
                    Sækja
                </button>
                <a href='{{collection.get_edit_url()}}' class='btn btn-warning btn-sm mb-2 ml-2 float-right'>
                    {{macros.btn_icon('edit', 'r')}}
                    Breyta
                </a>
                <button type='button' data-toggle='modal', data-target='#deleteModal' class='btn btn-danger btn-sm float-right mb-2'>
                    {{macros.btn_icon('trash', 'r')}}
                    Eyða söfnun
                </button>
            {% endif %}
        </div>
    </div>
    <div class='row mt-2'>
        <div class='col-12'>
            <h3 class='font-weight-bold'>Textar</h3>
        </div>
        <div class='col-12'>
            {% with tokens=tokens.items %}
                {% include '_token_table.jinja'%}
            {% endwith %}
        </div>
    </div>
    <div class='row mt-3'>
        <div class='col-12'>
            <!-- Quick fix for compiling, replace token_list with collection -->
            {{macros.pagination(tokens, url_for("collection", id=collection.id))}}
        </div>
    </div>
{% endblock %}

{% block modals %}
    <div class="modal fade" id='addTokensModal' tabindex="-1">
        <form method='POST' enctype="multipart/form-data">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bæta við textum</h5>
                    <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                        <p>
                            Veljið eitt eða fleiri skjöl hér að neðan. Textaskjal sem inniheldur fleiri en eina línu er túlkað
                            sem margir textabútar og textaskjölin vistast sem slík (5 línur í textaskrá samsvarar 5 textum til dæmis).

                            G2P skjal þarf að vera að vera tab-seperated listi af setningum þannig að hver lína inniheldur
                            <ul class="list-group">
                                <li class="list-group-item">Sjálfa setninguna</li>
                                <li class="list-group-item">Uppruna setningar (t.d. "risamálheild")</li>
                                <li class="list-group-item">Röðunarstuðul (einhver fleytitala, hærri því fyrr birtist setningin)</li>
                                <li class="list-group-item">Framburð (t.d. "~ uː t s m ɔi j ɪ n ~")</li>
                            </ul>
                        </p>
                        {% with form=token_form %}
                            {% include '_form.jinja' %}
                        {% endwith %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Loka</button>
                    <button class='btn btn-primary' type='submit'>
                        Klára
                        <span class='ml-1'><i class='fa fa-check'></i></span>
                    </button>
                </div>
                </div>
            </div>
        </form>
    </div>

    <div class="modal fade" id='deleteModal' tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Þú ert við það að eyða söfnun!</h5>
                <button type="button" class="close" data-dismiss="modal">
                <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>
                Með því að eyða söfnun eyðast allar upptökur og allar setningar
                sem settar hafa verið inn fyrir söfnunina: {{collection.name}}.
                <br><br>
                Þessi söfnun hefur {{collection.num_tokens}} setningar og búið er
                að taka upp {{collection.get_complete_ratio(as_percent=True)}}% af þeim.
                <br><br>
                Ertu viss um að þú viljir eyða þessari söfnun?
                </p>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Loka</button>
                <a href='{{url_for("delete_collection", id=collection.id)}}' class='btn btn-danger'>
                    Eyða
                    {{macros.btn_icon('times', 'l')}}
                </a>
            </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id='downloadModal' tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Sækja söfnun</h5>
                <button type="button" class="close" data-dismiss="modal">
                <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                {% if collection.has_zip %}
                    <p class='font-weight-bold'>
                        Búið er að útbúa skjalasafn fyrir þessa söfnun
                    </p>
                    <p>
                        Skjalasafnið var gert þegar búið var að lesa {{collection.zip_token_count}} setningar.
                        Núna er búið að lesa {{collection.num_tokens - collection.num_nonrecorded_tokens}} setningar.
                        Þú getur annað hvort búið til nýtt skjalasafn eða náð í það nýjasta.
                    </p>
                {% else %}
                    <p class='font-weight-bold'>
                        Ekki er búið að útbúa skjalasafn
                    </p>
                    <p>
                        Til að ná í söfnun þarf fyrst að útbúa skjalasafn. Þegar skjalasafnið er tilbúið birtist
                        það <a target="_blank" rel="noopener noreferrer" href='{{url_for("collection_zip_list")}}'>hér</a>.
                        Athugið að það getur tekið allt að 10 mínútur að útbúa skjalasafnið.
                    </p>
                {% endif %}
            </div>
            <div class="modal-footer">
                {% if collection.has_zip %}
                    <a href='{{url_for("stream_collection_zip", id=collection.id)}}' class='btn btn-primary'>
                        Sækja söfnun
                        {{macros.btn_icon('download', 'r')}}
                    </a>
                {% endif %}
                <a href='{{url_for("generate_zip", id=collection.id)}}' class='btn btn-secondary'>
                    Gera skjalasafn
                    {{macros.btn_icon('archive', 'r')}}
                </a>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Loka</button>
            </div>
            </div>
        </div>
    </div>

    {% include '_user_confirm_modal.jinja' %}
{% endblock %}